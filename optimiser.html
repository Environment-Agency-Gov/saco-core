

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimiser &mdash; saco  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Calculator" href="calculator.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            saco
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Background:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculator.html">Calculator</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimiser</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#conceptualisation">Conceptualisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simplifications">Simplifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-definition">Problem Definition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#objective-s">Objective(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constraints">Constraints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#customisation">Customisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trade-offs">Trade-Offs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="fields.html">Table Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-calculate.html">Calculator</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-optimise.html">Optimiser</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">saco</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Optimiser</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/optimiser.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimiser">
<h1>Optimiser<a class="headerlink" href="#optimiser" title="Link to this heading"></a></h1>
<p>The Optimiser identifies potential artificial influence changes that could achieve flow
targets by solving an optimisation problem. Similar to the Calculator, the starting
point could be the “base” WRGIS tables or a modified/alternative version of “WRGIS-like”
tables. Key outputs from this component include updated tables of how the artificial
influence impacts were changed by the solver to help meet flow targets.</p>
<section id="conceptualisation">
<h2>Conceptualisation<a class="headerlink" href="#conceptualisation" title="Link to this heading"></a></h2>
<p>For the Optimiser we conceptualise waterbodies and artificial influences as nodes in a
network. The network can be thought of as follows (see also the diagram below for a
very simple hypothetical case):</p>
<blockquote>
<div><ul class="simple">
<li><p>Waterbody nodes are connected via directed edges/arcs to their downstream
neighbours according to the relationships given in WRGIS.</p></li>
<li><p>Each waterbody node has an inflow, which represents runoff generated within the
waterbody (i.e. “sub” flows). These inflows are set as natural “sub” flows unless
any artificial influences are being held constant, in which case inflows are
adjusted to account for these impacts upfront. See below for more details.</p></li>
<li><p>Aside from any held constant, each artificial influence also has a node (see
below for a complication about groundwater abstractions). A directed edge connects
the impacted waterbody to the relevant artificial influence.</p></li>
<li><p>Each artificial influence node has a target impact. For abstractions, the nodes
are therefore similar to demand nodes in water resources systems modelling.</p></li>
<li><p>Groundwater abstractions that impact multiple waterbodies have multiple nodes,
one per impacted waterbody. The target impacts for a given groundwater abstraction
are held in the proportions given in WRGIS (see <a class="reference internal" href="data.html"><span class="doc">Data</span></a>).</p></li>
</ul>
</div></blockquote>
<img alt="_images/network.png" src="_images/network.png" />
<p>The problem then is to find the optimal set of flows along all of the edges, according
to some objective(s) and constraints that we define. Note that (for now at least) we
have one network flow problem for each combination of artificial influences scenario and
flow percentile that we are interested in. This approach provides a solution for a given
percentile independently of other percentiles.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functionality has been added to translate the solution for a given percentile into
a set of long-term average changes under the assumption of constant (relative)
impact profiles across the flow duration curve (FDC) or seasonally. See the
<code class="docutils literal notranslate"><span class="pre">infer_mean_abstraction</span></code> entry in <a class="reference internal" href="reference-dataset.html"><span class="doc">Dataset</span></a> and the notes in
<a class="reference internal" href="reference-optimise.html"><span class="doc">Optimiser</span></a>. We also note that alternative approaches could
be used to relax the assumption to a degree and that future work may seek to
optimise “across the FDC” in a more holistic manner.</p>
</div>
<p>Once solved, by looking at the relevant edges we can get at the following terms:</p>
<blockquote>
<div><ul class="simple">
<li><p>Waterbody outflows (i.e. “ups” scenario flows), for which we can then calculate
surpluses/deficits and compliance classifications.</p></li>
<li><p>Actual artificial influence impacts. These impacts may be less than the target
impacts if (i) the target impacts are not possible and/or (ii) a lower impact
is identified by the solver as resulting in the optimal solution.</p></li>
</ul>
</div></blockquote>
<p>For the latter set of edges, we can compare the actual impacts with the target impacts
to back out the required impact changes - i.e. the current key output of the Optimiser.
See note above about translation to long-term average changes.</p>
</section>
<section id="simplifications">
<h2>Simplifications<a class="headerlink" href="#simplifications" title="Link to this heading"></a></h2>
<p>At this point it is worth introducing a couple of simplifications currently made in
the Optimiser:</p>
<blockquote>
<div><ul class="simple">
<li><p>Discharges (listed in Discharges_NBB) are held constant in the solution at
present, i.e. they are not adjusted by the solver either to help meet flow
targets or to maintain (sometimes complicated) relationships with abstractions.
Therefore, currently discharges are held constant (by adding their impact upfront
to the relevant inflow terms in the waterbody network).</p></li>
<li><p>By default, complex impacts are also held constant in the solution (again by
adjusting the relevant waterbody inflow terms upfront).</p></li>
</ul>
</div></blockquote>
<p>On the latter point, however, exploratory (and optional) functionality has been added
to allow the inclusion of (1) increases to reservoir compensation flows (up to a
user-specific maximum increase) and (2) reduction of abstractions listed as complex
(typically due to the conditions that govern their operation and resulting impact
across the FDC). See the <a class="reference internal" href="tutorial.html"><span class="doc">Tutorial</span></a> for a guide to the current complex impact
functionality.</p>
</section>
<section id="problem-definition">
<h2>Problem Definition<a class="headerlink" href="#problem-definition" title="Link to this heading"></a></h2>
<p>The network flow conceptualisation outlined above can be formulated and solved via the
linear programming family of methods. For this, we need to define “optimal” in our case
and express it as an objective(s). We also need to define the conditions that must be
satisfied in a solution as a set of constraints.</p>
<section id="objective-s">
<h3>Objective(s)<a class="headerlink" href="#objective-s" title="Link to this heading"></a></h3>
<p>One natural objective for this problem is to minimise the total abstraction impact
reductions needed to meet flow targets. This is equivalent to maximising the total
abstraction impact up to the limits imposed by the abstraction scenario. This is the
the currently recommended primary objective for the Optimiser.</p>
<p>The Optimiser supports solution for multiple objectives via a sequential approach. For
example, after solving for the primary objective, the primary objective can become a
constraint and we can solve for a secondary objective.</p>
<p>Testing so far has largely used a (proportional) equality metric as a secondary
objective. This is on the basis that it is better to distribute relative impact
reductions equally amongst abstractors, rather than unequally, if possible. The nature
of the problem is such that solutions for the primary objective (minimum impact
reduction) can easily be non-unique, with the solver returning a potentially arbitrary
choice of solution from the optimal set. There is thus a need/opportunity to nudge the
solution choice to one with desired properties.</p>
<p>For this secondary equality objective, we seek to maximise the equality of the
proportions of target abstraction impacts fulfilled at the point(-purpose) scale. We
quantify equality as the mean absolute deviation from a target proportion. The target
proportion is taken as the proportion of total abstraction fulfilled in the solution
associated with the primary objective. The mean absolute deviation from this target is
then generally lower (better) if all abstraction points have similar proportional
impact fulfillment to the target proportion.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For large domains including multiple catchments, the Optimiser will evaluate the
target proportion (and the mean absolute deviation) for each catchment. Catchments
will be identified as all waterbodies upstream of - and including - the most
downstream waterbodies in the domain passed to the Optimiser.</p>
</div>
<p>An alternative secondary objective is available to explore how a solution may change if
we try to minimise the number of individual changes made. This objective is handled via
a proxy metric that uses weighting inversely proportional to impact size to promote
sparsity in the solution. A proxy metric is used as minimising a count forms a
potentially non-convex optimisation problem that is not handled by the disciplined
convex programming package (cvxpy) that underpins the Optimiser.</p>
</section>
<section id="constraints">
<h3>Constraints<a class="headerlink" href="#constraints" title="Link to this heading"></a></h3>
<p>Several constraints are applied in the problem formulation, regardless of the objective
being used. These constraints may be summarised as:</p>
<blockquote>
<div><ul class="simple">
<li><p>Edge flows must be non-negative.</p></li>
<li><p>Abstraction impacts must not exceed their target rates.</p></li>
<li><p>Waterbody outflows must be greater than or equal to their target flows. I.e. flow
targets are a hard constraint.</p></li>
<li><p>Mass balance principles must be respected, such that the sum of inputs to and
outputs from a waterbody must be equal. Inputs are inflows from upstream neighbour
waterbodies that flow into the waterbody in question, as well as runoff generated
within the waterbody and any discharges within the waterbody. Outputs are the
waterbody outflow to its downstream neighbour and any abstractions within the
waterbody. Complex impacts that act to increase or decrease flow are also
accounted for in the mass balance.</p></li>
<li><p>Groundwater abstractions that impact multiple waterbodies must do so according to
the fixed ratios given in WRGIS. For example, if a groundwater abstraction’s
total impact is split between two waterbodies in a ratio 2:1 in WRGIS, this ratio
must be respected in the solution.</p></li>
<li><p>Hands-off flow (HOF) conditions must be respected for the surface water
abstractions to which they apply.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a target cannot be feasibly met, by default it will be dropped and a warning
message displayed. This situation can occur if some impacts are held constant (e.g.
complex impacts) that have a large effect on flows. See <a class="reference internal" href="reference-optimise.html"><span class="doc">Optimiser</span></a>
for more details, including options on customising behaviour when faced with
infeasible targets.</p>
</div>
<p>The final constraint listed above constitutes a threshold condition. If flow drops
beyond some threshold then an abstraction must be switched off. If flow is above the
threshold then an impact can take place up to the target rate. This transforms the
problem from a pure linear programming problem into a mixed integer (binary) linear
programming problem.</p>
<p>As noted above, if a solution is being sought for a secondary objective, the primary
objective is applied a constraint on the solution. In the current setup, this means
that the optimal maximum total abstraction found when solving for the primary objective
is included as an additional constraint when seeking a solution for a secondary
objective.</p>
<p>We can also observe now that the issue of “capping” discussed in <a class="reference internal" href="calculator.html"><span class="doc">Calculator</span></a> is
dissolved by the formulation for the Optimiser to some extent. The non-negativity
constraint prevents scenario flows becoming negative, i.e. abstraction impacts on flows
have to remain compatible with non-negative scenario flows.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One possible (edge) case relates to groundwater abstractions impacting waterbodies
with outflow targets of zero. So long as other constraints are respected (and under
some assumptions about the relevant hydrogeology), it could be possible to have
groundwater abstraction that exceeds the impact on flow. This may not be relevant
in most cases, where flow targets will be above zero, but the handling of this
case could be refined in future.</p>
</div>
</section>
</section>
<section id="customisation">
<h2>Customisation<a class="headerlink" href="#customisation" title="Link to this heading"></a></h2>
<p>It is possible to customise the behaviour of the Optimiser in a number of ways,
including:</p>
<blockquote>
<div><ul class="simple">
<li><p>The starting point for the Optimiser could be the “base” WRGIS tables or a
modified/alternative version of “WRGIS-like” tables. This offers the possibility
to prescribe some changes and allow the Optimiser to identify others.</p></li>
<li><p>Flow targets can be varied from their default (EFI) on a waterbody basis.</p></li>
<li><p>Abstractions can be selected for inclusion or exclusion in the optimisation at
the licence-point-purpose level.</p></li>
<li><p>Different objective choices can be tested in line with the capabilities outlined
above.</p></li>
</ul>
</div></blockquote>
<p>Default exclusions (from optimisation) are currently in place in relation to particular
types of abstractions, including for surface water abstractions with reservoir, lake or
level-dependent management unit flags in WRGIS. Former licences that are now deregulated
are also excluded, along with abstractions with small impacts below a (customisable)
threshold. See the <a class="reference internal" href="reference-dataset.html"><span class="doc">Dataset</span></a> page for details of these defaults, all of
which can be changed by a user.</p>
</section>
<section id="trade-offs">
<h2>Trade-Offs<a class="headerlink" href="#trade-offs" title="Link to this heading"></a></h2>
<p>If running with two or more (sequential) objectives, it is possible to explore
trade-offs between objectives. This is achieved by solving for the primary objective
and then “relaxing” its total abstraction impact result before applying it as a
constraint on the secondary objective. This process can be done repeatedly to explore
how successively larger relaxations (i.e. degrading the primary objective) affect the
secondary proportional equality objective (or other secondary objectives).</p>
<p>The size of trade-offs may vary between contexts and applications. In some cases any
trade-offs may be limited, whereas in others they may be important to consider. An
example of the latter for an anonymised test catchment is shown in the plot below.</p>
<img alt="_images/tradeoffs.png" src="_images/tradeoffs.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="calculator.html" class="btn btn-neutral float-left" title="Calculator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.html" class="btn btn-neutral float-right" title="Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Environment Agency.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>